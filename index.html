<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K Online Shopping</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
    
    <style>
        :root {
            --bg-color: #ffffff; --text-color: #2d2d2d;
            --header-bg: #2d2d2d; --header-text: #ffffff;
            --menu-bg: #ffffff; --active-tab: #eee;
        }
        body { font-family: 'Helvetica Neue', sans-serif; margin: 0; padding: 0; background: var(--bg-color); color: var(--text-color); }
        
        /* --- 1. HEADER --- */
        header { background: var(--header-bg); color: var(--header-text); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logo { font-weight: bold; font-size: 18px; letter-spacing: 1px; }
        .nav-icons i { font-size: 20px; margin-left: 15px; cursor: pointer; }

        /* --- 2. ASOS STYLE SIDE MENU --- */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 150; }
        .overlay.active { display: block; }

        .side-menu { height: 100%; width: 300px; position: fixed; top: 0; left: -300px; background: var(--menu-bg); transition: left 0.3s; z-index: 200; display: flex; flex-direction: column; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
        .side-menu.active { left: 0; }

        /* Women / Men Tabs */
        .menu-tabs { display: flex; height: 50px; border-bottom: 1px solid #ddd; }
        .tab { flex: 1; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; background: #fff; color: #777; }
        .tab.active { border-bottom: 2px solid #2d2d2d; color: #2d2d2d; background: #f9f9f9; }

        /* Menu List */
        .menu-content { flex: 1; overflow-y: auto; }
        .menu-section { display: none; } /* Hide all sections by default */
        .menu-section.active { display: block; } /* Show active section */

        .menu-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; border-bottom: 1px solid #eee; 
            text-decoration: none; color: #333; font-weight: 500; transition: 0.2s;
        }
        .menu-item:hover { background: #f5f5f5; padding-left: 25px; }
        .menu-item img { width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; object-fit: cover;}
        .menu-text { flex: 1; }
        .menu-arrow { color: #ccc; font-size: 12px; }

        /* Close Button */
        .close-btn { position: absolute; top: 10px; right: -40px; color: white; font-size: 30px; cursor: pointer; }

        /* --- 3. PRODUCT DISPLAY AREA --- */
        .main-content { padding: 20px; min-height: 80vh; }
        .section-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); /* 2 Columns on mobile */
            gap: 15px; 
        }
        
        .product-card { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-decoration: none; color: inherit; }
        .p-img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .p-info { padding: 10px; }
        .p-name { font-size: 13px; height: 36px; overflow: hidden; margin-bottom: 5px; }
        .p-price { font-weight: bold; font-size: 14px; }

        /* Footer */
        .main-footer { text-align: center; padding: 30px; background: #f9f9f9; margin-top: 30px; font-size: 12px; color: #666; }
    </style>
</head>
<body>

    <div class="overlay" onclick="toggleMenu()"></div>

    <header>
        <div onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
        <div class="logo">K Online Shopping</div>
        <div class="nav-icons">
            <i class="fas fa-search"></i> 
            <i class="fas fa-shopping-bag"></i>
        </div>
    </header>

    <div class="side-menu" id="sideMenu">
        <div class="close-btn" onclick="toggleMenu()">&times;</div>
        
        <div class="menu-tabs">
            <div class="tab active" onclick="switchTab('women')">WOMEN</div>
            <div class="tab" onclick="switchTab('men')">MEN</div>
        </div>

        <div class="menu-content">
            
            <div id="women-menu" class="menu-section active">
                <div style="padding: 15px; background: #f4f4f4; font-weight: bold;">SHOP BY CATEGORY</div>
                
                <a href="#" class="menu-item" onclick="loadProducts('all', 'WOMEN - ALL')">
                    <div class="menu-text">Home</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" onclick="loadProducts('new_in', 'New Arrivals')">
                    <div class="menu-text">New In</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" onclick="loadProducts('clothing', 'Clothing')">
                    <img src="https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=50">
                    <div class="menu-text">Clothing</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" onclick="loadProducts('shoes', 'Shoes')">
                    <img src="https://images.unsplash.com/photo-1543163521-1bf539c55dd2?w=50">
                    <div class="menu-text">Shoes</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" onclick="loadProducts('bag', 'Accessories')">
                    <img src="https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=50">
                    <div class="menu-text">Accessories</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" style="color:red; font-weight:bold;" onclick="loadProducts('sale', 'Sale')">
                    <div class="menu-text">Sale</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
            </div>

            <div id="men-menu" class="menu-section">
                <div style="padding: 15px; background: #f4f4f4; font-weight: bold;">SHOP FOR MEN</div>
                
                <a href="#" class="menu-item" onclick="loadProducts('men_all', 'MEN - ALL')">
                    <div class="menu-text">Home</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" onclick="loadProducts('men_clothing', 'Clothing')">
                    <img src="https://images.unsplash.com/photo-1617137968427-85924c809a00?w=50">
                    <div class="menu-text">Clothing</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
                <a href="#" class="menu-item" onclick="loadProducts('men_shoes', 'Shoes')">
                    <img src="https://images.unsplash.com/photo-1617606002779-51d866bdd1d1?w=50">
                    <div class="menu-text">Shoes</div> <i class="fas fa-chevron-right menu-arrow"></i>
                </a>
            </div>

        </div>
    </div>

    <div class="main-content">
        <div class="section-title">
            <span id="pageTitle">The Party Preview</span>
        </div>
        
        <div id="loading" style="text-align:center; display:none; padding:50px;">
            <i class="fas fa-spinner fa-spin" style="font-size:30px; color:#333;"></i>
        </div>

        <div class="product-grid" id="productsContainer">
            <p style="grid-column: 1/-1; text-align: center; color: #888;">Loading products...</p>
        </div>
    </div>

    <footer class="main-footer">
        Yangon, Myanmar<br>09752965423<br>
        @ K Online Shopping 2025
    </footer>

    <script>
        // --- 1. SUPABASE SETUP (YOUR CORRECT KEY) ---
        const SUPABASE_URL = 'https://hfsvxmnhoylhzbzvamiq.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhmc3Z4bW5ob3lsaHpienZhbWlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NjIzNzEsImV4cCI6MjA3OTEzODM3MX0.J37qWQaKqecVsmGWWj63CyClVDup6KAD24iZVjIIL-0'; 
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- 2. SOUND SYSTEM ("တောက်" အသံ) ---
        // Website တစ်ခုလုံး ဘယ်နေရာနှိပ်နှိပ် အသံမြည်မည့် Code
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playClickSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime); // Tone
            osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.05);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); // Volume
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }
        // Listen to ALL clicks on the document
        document.addEventListener('click', () => playClickSound());


        // --- 3. MENU LOGIC (TAB SWITCHING) ---
        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
        }

        function switchTab(tabName) {
            // UI update
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.menu-section').forEach(s => s.classList.remove('active'));

            if(tabName === 'women') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('women-menu').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('men-menu').classList.add('active');
            }
        }

        // --- 4. DYNAMIC PRODUCT LOADING (SINGLE PAGE) ---
        async function loadProducts(categoryTag, displayTitle) {
            // 1. Close Menu
            toggleMenu();
            
            // 2. Update Title & Show Loading
            document.getElementById('pageTitle').innerText = displayTitle;
            const container = document.getElementById('productsContainer');
            const loader = document.getElementById('loading');
            
            container.innerHTML = ''; // Clear old products
            loader.style.display = 'block'; // Show spinner

            // 3. Build Query
            let query = supabaseClient.from('products').select('*');
            
            // 'all' မဟုတ်ရင် category နဲ့ စစ်မယ်
            if (categoryTag !== 'all' && categoryTag !== 'men_all') {
                query = query.eq('category', categoryTag);
            }

            // 4. Fetch Data
            let { data: products, error } = await query;
            
            loader.style.display = 'none'; // Hide spinner

            if (error) {
                console.error(error);
                container.innerHTML = `<p style="color:red; text-align:center; grid-column:1/-1;">Error loading data.</p>`;
                return;
            }

            if (!products || products.length === 0) {
                container.innerHTML = `<p style="text-align:center; grid-column:1/-1; color:#777;">No items found in ${displayTitle}.</p>`;
                return;
            }

            // 5. Display Products
            let html = '';
            products.forEach(p => {
                const price = p.price ? Number(p.price).toLocaleString() : '0';
                const img = p.image_url ? p.image_url : 'https://via.placeholder.com/300x400?text=No+Image';
                
                html += `
                    <a href="#" class="product-card">
                        <img src="${img}" class="p-img">
                        <div class="p-info">
                            <div class="p-name">${p.name}</div>
                            <div class="p-price">${price} Ks</div>
                        </div>
                    </a>`;
            });
            container.innerHTML = html;
        }

        // Initial Load
        loadProducts('all', 'The Party Preview');

    </script>
</body>
</html>
