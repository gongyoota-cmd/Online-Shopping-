<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Lab</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
    
    <style>
        /* COLOR THEME */
        :root {
            --bg-color: #f9f9f9; 
            --text-color: #333;
            --header-bg: #4a148c; /* Deep Purple */
            --header-text: #ffffff;
            --card-bg: #ffffff; 
            --accent-color: #e91e63; /* Pink */
            --vibrant-blue: #03a9f4; 
            --secondary-text: #777;
        }
        /* Dark Mode */
        body.dark-mode {
            --bg-color: #121212; 
            --text-color: #e0e0e0;
            --header-bg: #000000; 
            --header-text: #ffffff;
            --card-bg: #1e1e1e;
            --vibrant-blue: #4fc3f7;
            --secondary-text: #b0b0b0;
        }

        body { font-family: 'Helvetica Neue', sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-color); }
        .header { background-color: var(--header-bg); color: var(--header-text); padding: 10px; display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; left: 0; right: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .header h1 { font-size: 1.2em; margin: 0; }
        .search-bar { background-color: var(--header-text); border-radius: 20px; padding: 5px 10px; display: flex; align-items: center; width: 60%; max-width: 300px; }
        .search-bar input { border: none; outline: none; background: none; color: var(--text-color); width: 100%; padding: 0 5px; }
        .search-bar i { color: var(--secondary-text); margin-right: 5px; }

        .content { padding-top: 110px; padding-bottom: 70px; }
        
        .tabs { display: flex; justify-content: space-around; background-color: var(--card-bg); position: fixed; top: 50px; left: 0; right: 0; z-index: 90; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .tab { padding: 10px; cursor: pointer; color: var(--secondary-text); font-weight: bold; position: relative; }
        .tab.active { color: var(--accent-color); }
        .tab.active::after { content: ''; display: block; height: 3px; background-color: var(--accent-color); position: absolute; bottom: 0; left: 0; right: 0; border-radius: 2px 2px 0 0; }
        
        .menu-section { display: none; padding: 10px; }
        .menu-section.active { display: block; }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        .product-card { background-color: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow: hidden; position: relative; display: flex; flex-direction: column; }
        
        /* PRODUCTS GRID: Multi-Image Slider Styles (NEW) */
        .p-img-slider { 
            width: 100%; 
            height: 200px; 
            overflow: hidden; 
            position: relative; 
        }
        .p-img-wrapper { 
            display: flex; 
            height: 100%; 
            transition: transform 0.3s ease-in-out; 
        }
        .p-img-slide { 
            min-width: 100%; 
        }
        .p-img-slide img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            background: #eee; 
        }
        /* Slider Navigation Buttons (NEW) */
        .slider-nav-btn { 
            position: absolute; 
            top: 50%; 
            transform: translateY(-50%); 
            z-index: 55; 
            color: white; 
            background: rgba(0,0,0,0.5); 
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer; 
            transition: opacity 0.2s;
        }
        .slider-nav-btn.left { left: 5px; }
        .slider-nav-btn.right { right: 5px; }
        .slider-nav-btn:hover { opacity: 0.8; }
        /* End Multi-Image Styles */

        .p-info { padding: 8px; flex-grow: 1; }
        .p-name { font-size: 0.9em; font-weight: 500; margin-bottom: 5px; line-height: 1.2; }
        
        /* P-PRICE STYLES (UPDATED) */
        .p-price { 
            font-size: 0.8em; 
            color: var(--text-color); 
            line-height: 1.3;
        }
        .price-unit { 
            font-weight: bold; 
            font-size: 1em; 
            color: var(--text-color); 
        }
        .price-wholesale { 
            font-size: 0.9em; 
            color: var(--accent-color); 
            font-weight: bold;
            margin-top: 2px;
        }
        .price-note { 
            font-size: 0.7em; 
            color: var(--secondary-text);
        }
        
        .cart-btn { 
            position: absolute; 
            bottom: 8px; 
            right: 8px; 
            background-color: var(--accent-color); 
            color: var(--header-text); 
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.1em; 
            cursor: pointer; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); 
            z-index: 60;
        }

        .footer { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--card-bg); display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 100; }
        .footer-item { text-align: center; font-size: 0.8em; color: var(--secondary-text); cursor: pointer; }
        .footer-item i { font-size: 1.4em; margin-bottom: 3px; }
        .footer-item.active { color: var(--accent-color); }

        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: var(--card-bg); margin: 15% auto; padding: 20px; border-radius: 10px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .close { color: var(--secondary-text); float: right; font-size: 28px; font-weight: bold; }
        .close:hover, .close:focus { color: var(--text-color); text-decoration: none; cursor: pointer; }
        .modal-content h2 { color: var(--header-bg); margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        /* Checkout Form Styles */
        #checkoutForm label { display: block; margin-top: 10px; font-weight: bold; }
        #checkoutForm input[type="text"], #checkoutForm input[type="number"], #checkoutForm textarea { width: 100%; padding: 10px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px; background-color: var(--bg-color); color: var(--text-color); }
        #checkoutForm button { background-color: var(--accent-color); color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; margin-top: 20px; width: 100%; }
        #checkoutForm button:hover { background-color: #d81b60; }
        
        /* Theme Toggle */
        .theme-toggle { position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 1.2em; color: var(--header-text); }
        
        /* Price Display in Modal (NEW) */
        #totalPriceDisplay { font-size: 1.5em; font-weight: bold; color: var(--accent-color); margin: 10px 0; text-align: right; }
        
    </style>
</head>
<body>

    <div class="header">
        <h1>Fashion Lab</h1>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äï·Ä´..." onkeyup="searchProducts()">
        </div>
        <div class="theme-toggle" onclick="toggleTheme()">
            <i class="fas fa-moon"></i>
        </div>
    </div>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('women')">·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Äû·Äô·ÄÆ·Ä∏</div>
        <div class="tab" onclick="switchTab('men')">·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Äû·Ä¨·Ä∏</div>
    </div>

    <div class="content">
        <div id="women-menu" class="menu-section active">
            <div class="product-grid" id="productsContainer">
                </div>
        </div>
        <div id="men-menu" class="menu-section">
            <div class="product-grid" id="menProductsContainer">
                </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-item active"><i class="fas fa-home"></i><br>·Äï·ÄÑ·Ä∫·Äô·ÄÖ·Ä¨·Äô·Äª·ÄÄ·Ä∫·Äî·Äæ·Ä¨</div>
        <div class="footer-item"><i class="fas fa-star"></i><br>·Äú·Ä∞·ÄÄ·Äº·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏</div>
        <div class="footer-item"><i class="fas fa-user"></i><br>·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫</div>
    </div>

    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('checkoutModal')">&times;</span>
            <h2>·Äô·Äæ·Ä¨·Äö·Ä∞·Äõ·Äî·Ä∫ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫</h2>
            <p id="selectedProductName" style="font-weight: bold;"></p>
            
            <form id="checkoutForm">
                <input type="hidden" id="productId">
                
                <label for="quantity">·Ä°·Äõ·Ä±·Ä°·Äê·ÄΩ·ÄÄ·Ä∫</label>
                <input type="number" id="quantity" name="quantity" min="1" value="1" required onchange="calculateTotal()">

                <div id="priceDetailDisplay" style="margin-top: 10px; font-size: 0.9em; color: var(--secondary-text);"></div>
                
                <div id="totalPriceDisplay">0 Ks</div>
                
                <label for="name">·Ä°·Äô·Ää·Ä∫</label>
                <input type="text" id="name" name="name" required>
                
                <label for="phone">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</label>
                <input type="text" id="phone" name="phone" required>
                
                <label for="address">·Äú·Ä≠·Äï·Ä∫·ÄÖ·Ä¨</label>
                <textarea id="address" name="address" required></textarea>
                
                <button type="submit">·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ</button>
            </form>
        </div>
    </div>

    <script>
        // Supabase Client Initialization (Please replace with your actual keys)
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Telegram Bot Configuration (Replace with your actual details)
        const TELEGRAM_BOT_TOKEN = 'YOUR_TELEGRAM_BOT_TOKEN';
        const TELEGRAM_CHAT_ID = 'YOUR_TELEGRAM_CHAT_ID'; // Group or User ID

        // Global variable to hold all products
        let allProducts = [];

        // --- CORE FUNCTIONS ---

        async function loadProducts() {
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*');

                if (error) throw error;

                allProducts = data;
                
                // Separate products by category (assuming a 'category' column exists)
                const womenProducts = allProducts.filter(p => p.category === 'women');
                const menProducts = allProducts.filter(p => p.category === 'men');
                
                renderProducts(womenProducts, 'women');
                renderProducts(menProducts, 'men', true); // Render men's products to its container

            } catch (error) {
                console.error('Error loading products:', error.message);
                document.getElementById('productsContainer').innerHTML = '<h2>·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏ load ·Äô·Äú·ÄØ·Äï·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´</h2>';
            }
        }
        
        // --- Product Display (UPDATED for Multi-Images and Multi-Prices) ---

        function renderProducts(list, category, isMen = false) {
            const con = isMen ? document.getElementById('menProductsContainer') : document.getElementById('productsContainer');
            con.innerHTML = '';

            list.forEach((p, index) => {
                
                // 1. Image URL ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ Array ·Ä°·Äñ·Äº·ÄÖ·Ä∫ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äö·Ä∞·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ (Multi-Image Logic)
                let images = [];
                if (Array.isArray(p.image_urls) && p.image_urls.length > 0) {
                    images = p.image_urls;
                } else if (typeof p.image_url === 'string' && p.image_url.includes(';')) {
                    images = p.image_url.split(';').map(url => url.trim()).filter(url => url.length > 0);
                } else {
                    images = [p.image_url || 'https://via.placeholder.com/300'];
                }
                
                // 2. Price Display Logic (Multi-Price Logic)
                const unitPrice = Number(p.unit_price || p.price || 0); // unit_price or fallback
                const wholesalePrice = Number(p.wholesale_price || 0);
                const minQty = Number(p.wholesale_min_qty || 5);

                let priceHTML = '';
                
                // Display Unit Price
                priceHTML += `<div class="price-note">·Äê·ÄÖ·Ä∫·Äë·Ää·Ä∫·Äà·Ä±·Ä∏:</div><div class="price-unit">${unitPrice.toLocaleString()} Ks</div>`;

                // Display Wholesale Price if available
                if (wholesalePrice > 0 && wholesalePrice < unitPrice) {
                    priceHTML += `<div class="price-wholesale">${wholesalePrice.toLocaleString()} Ks</div>`;
                    priceHTML += `<div class="price-note">(${minQty} ·Äë·Ää·Ä∫·Äô·Äæ ·ÄÖ·Åç)</div>`;
                }

                // 3. Image Slides HTML
                let imageSlidesHTML = images.map(imgUrl => 
                    `<div class="p-img-slide"><img src="${imgUrl}" alt="${p.name}"></div>`
                ).join('');

                // 4. Navigation Buttons 
                const navButtons = images.length > 1 ? `
                    <div class="slider-nav-btn left" onclick="prevProductImage(${index}, '${category}')"><i class="fas fa-chevron-left"></i></div>
                    <div class="slider-nav-btn right" onclick="nextProductImage(${index}, '${category}')"><i class="fas fa-chevron-right"></i></div>
                ` : '';

                con.innerHTML += `
                <div class="product-card">
                    <div class="p-img-slider" id="slider-${category}-${index}">
                        <div class="p-img-wrapper" data-index="0" style="width: ${images.length * 100}%;">${imageSlidesHTML}</div>
                        ${navButtons}
                    </div>
                    <div class="p-info">
                        <div class="p-name">${p.name}</div>
                        <div class="p-price">${priceHTML}</div>
                    </div>
                    <div class="cart-btn" onclick="buyItem(${p.id})"><i class="fas fa-plus"></i></div>
                </div>`;
            });
        }
        
        // --- Product Card Multi-Image Slider Logic (NEW) ---

        function moveProductImage(index, category, direction) {
            const wrapper = document.querySelector(`#slider-${category}-${index} .p-img-wrapper`);
            if (!wrapper) return;
            const slides = wrapper.querySelectorAll('.p-img-slide');
            if (slides.length <= 1) return;

            let currentIndex = parseInt(wrapper.getAttribute('data-index') || 0);
            
            currentIndex += direction; 
            if (currentIndex >= slides.length) currentIndex = 0;
            if (currentIndex < 0) currentIndex = slides.length - 1;

            wrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
            wrapper.setAttribute('data-index', currentIndex);
        }

        function prevProductImage(index, category) { 
            event.stopPropagation(); 
            moveProductImage(index, category, -1); 
        }
        function nextProductImage(index, category) { 
            event.stopPropagation(); 
            moveProductImage(index, category, 1); 
        }

        // --- BUY ITEM & CHECKOUT LOGIC (UPDATED for Multi-Prices) ---
        
        let selectedProduct = null;

        function buyItem(productId) {
            selectedProduct = allProducts.find(p => p.id === productId);
            if (!selectedProduct) return;

            document.getElementById('selectedProductName').innerText = selectedProduct.name;
            document.getElementById('productId').value = productId;
            document.getElementById('quantity').value = 1; // Reset quantity
            
            calculateTotal(); // Calculate initial price
            openModal('checkoutModal');
        }

        function calculateTotal() {
            if (!selectedProduct) return;
            
            const qtyInput = document.getElementById('quantity');
            let quantity = parseInt(qtyInput.value) || 1;
            qtyInput.value = quantity; // Ensure input reflects valid number

            const unitPrice = Number(selectedProduct.unit_price || selectedProduct.price || 0);
            const wholesalePrice = Number(selectedProduct.wholesale_price || 0);
            const minQty = Number(selectedProduct.wholesale_min_qty || 5);
            
            let finalPricePerUnit = unitPrice;
            let priceNote = `·Äê·ÄÖ·Ä∫·Äë·Ää·Ä∫·Äú·Äª·Äæ·ÄÑ·Ä∫ ${unitPrice.toLocaleString()} Ks`;
            
            // Apply wholesale price logic
            if (wholesalePrice > 0 && quantity >= minQty && wholesalePrice < unitPrice) {
                finalPricePerUnit = wholesalePrice;
                priceNote = `(·Ä°·Äô·Äª·Ä¨·Ä∏·Äà·Ä±·Ä∏·Äñ·Äº·ÄÑ·Ä∑·Ä∫) ·Äê·ÄÖ·Ä∫·Äë·Ää·Ä∫·Äú·Äª·Äæ·ÄÑ·Ä∫ ${wholesalePrice.toLocaleString()} Ks`;
            }
            
            const totalPrice = finalPricePerUnit * quantity;
            
            // Display details
            document.getElementById('priceDetailDisplay').innerHTML = `
                <div style="font-weight:bold;">${quantity} x ${finalPricePerUnit.toLocaleString()} Ks</div>
                <div>${priceNote}</div>
            `;
            document.getElementById('totalPriceDisplay').innerText = `${totalPrice.toLocaleString()} Ks`;
        }

        document.getElementById('checkoutForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const productId = document.getElementById('productId').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (!selectedProduct || !TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
                alert('·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åä ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äæ·ÄÑ·Ä∫·Äô·Äæ·ÄÜ·ÄÄ·Ä∫·Äê·ÄÑ·Ä∫·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã');
                return;
            }

            // Recalculate final price before sending (Safety check)
            calculateTotal(); 
            const totalPriceText = document.getElementById('totalPriceDisplay').innerText;
            const finalPricePerUnit = (totalPriceText.replace(' Ks', '').replace(/,/g, '') / quantity);

            const message = `
                üõçÔ∏è **·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ·Ä°·Äû·ÄÖ·Ä∫**
                -------------------------
                üë§ ·Ä°·Äô·Ää·Ä∫: ${name}
                üìû ·Äñ·ÄØ·Äî·Ä∫·Ä∏: ${phone}
                üè† ·Äú·Ä≠·Äï·Ä∫·ÄÖ·Ä¨: ${address}
                
                üì¶ ·Äô·Äæ·Ä¨·Äö·Ä∞·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏:
                - ·Äî·Ä¨·Äô·Ää·Ä∫: ${selectedProduct.name}
                - ·Ä°·Äõ·Ä±·Ä°·Äê·ÄΩ·ÄÄ·Ä∫: ${quantity}
                - ·Äê·ÄÖ·Ä∫·Äë·Ää·Ä∫·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏: ${finalPricePerUnit.toLocaleString()} Ks
                - ·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏: ${totalPriceText}
            `;
            
            const apiUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodeURIComponent(message)}&parse_mode=Markdown`;

            try {
                const response = await fetch(apiUrl);
                if (response.ok) {
                    alert('·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äô·Äæ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äï·Ä´·Äú·Ä≠·Äô·Ä∑·Ä∫·Äô·Ää·Ä∫·Åã');
                    closeModal('checkoutModal');
                    this.reset();
                } else {
                    alert('Telegram ·Äû·Ä≠·ÄØ·Ä∑·Äï·Ä≠·ÄØ·Ä∑·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã');
                }
            } catch (error) {
                console.error('Error sending order:', error);
                alert('·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã');
            }
        });

        // --- UI & UTILITY FUNCTIONS ---

        function openModal(id) { document.getElementById(id).style.display='block'; }
        function closeModal(id) { document.getElementById(id).style.display='none'; }
        
        function searchProducts() { 
            // Simplified search: only searches currently active product list
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeContainer = document.querySelector('.menu-section.active .product-grid');
            const productCards = activeContainer.querySelectorAll('.product-card');

            productCards.forEach(card => {
                const productName = card.querySelector('.p-name').innerText.toLowerCase(); 
                if (searchTerm.length === 0 || productName.includes(searchTerm)) card.style.display = 'flex'; 
                else card.style.display = 'none'; 
            });
        }
        
        function switchTab(t) { 
            document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.menu-section').forEach(e=>e.classList.remove('active'));
            if(t==='women'){ 
                document.querySelectorAll('.tab')[0].classList.add('active'); 
                document.getElementById('women-menu').classList.add('active'); 
            }
            else { 
                document.querySelectorAll('.tab')[1].classList.add('active'); 
                document.getElementById('men-menu').classList.add('active'); 
            }
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            document.querySelector('.theme-toggle i').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
        }

        // --- INITIALIZATION ---
        
        window.onload = () => {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle i').className = 'fas fa-sun';
            }
            loadProducts();
        };

    </script>
</body>
</html>
